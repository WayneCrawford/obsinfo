{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Instrumentation-Components",
	"description": "OBS facility instrument components",
	"type": "object",
	"required": [
		"instrumentation_components"
	],
	"properties": {
		"instrumentation_components": {
			"type": "object",
			"required": [
                "format_version",
				"revision",
				"facility",
				"response_format",
				"response_directory",
				"models"
			],
			"properties": {
                "format_version": {
                    "description": "Version of this file's schema",
                    "type": "string",
                    "minLength": 3,
                    "pattern": "^0\\.95$"
                },
				"revision": {
					"type": "object",
					"description": "Date provenance of instrumentation information",
					"required": ["date"],
					"properties": {
					    "date": { "$ref": "#/definitions/date" },
					    "author": {"$ref":"#/definitions/author"}
					}
				},
				"facility": {
					"type": "object",
					"description": "OBS facility information",
					"required": ["reference_name", "full_name", "email", "website"],
					"properties": {
						"reference_name": {
							"type": "string",
							"description": "YAML filename should be '{reference_name}.instrumentation.yaml'"
						},
						"full_name": { "type": "string" },
						"email": { "type": "string", "format": "email" },
						"website": { "type": "string", "format": "uri" },
						"phone_number": { "type": "string", "format": "phone" }
					}
				},
				"response_format": {
					"type": "string",
					"enum": ["RESPONSE_YAML"],
					"description": "format of response files"
				},
				"response_directory": {
					"type": "string",
					"description": "directory in which the response files are found"
				},
				"models": {
					"type": "object",
					"description": "Instrument component descriptions. Each category has an EquipmentType description and 0+ reponse_files references",
					"required": ["generic"],
					"properties": {
					    "generic" : {
					        "description" : "Generic descriptions of components",
					        "required" : ["datalogger", "sensor"],
					        "properties" : {
					            "datalogger" : {
					                "description" : "Datalogger equipment description and associated responses",
					                "patternProperties" : {
				                        "^[A-Za-z0-9_-]+$": {
                                            "required" : ["equipment","response"],
                                            "properties": {
                                                "equipment" : { "$ref": "#/definitions/equipmentType" },
                                                "response" : {
                                                    "required" : ["digitizer"],
                                                    "description": "response files for analog_filter, digitizer and digital filter in datalogger",
                                                    "properties" : {
                                                        "analog_filter" : {
                                                            "type": "string",
                                                            "description" : "(optional) response filename"
                                                        },
                                                        "digitizer" : {
                                                            "type": "string",
                                                            "description" : "response filename"
                                                        },
                                                        "digital_filter" : {
                                                            "type": "string",
                                                            "description" : "(optional) response filename"
                                                        }
                                                    },
                                                    "additionalProperties": false
                                                }
                                            }
                                        }
                                    }
					            },
					            "preamplifier" : {
					                "description" : "Preamplifier equipment description and associated responses",
					                "patternProperties" : {
				                        "^[A-Za-z0-9_-]+$": {
                                            "required" : ["equipment"],
                                            "properties": {
                                                "equipment" : { "$ref": "#/definitions/equipmentType" },
                                                "response" : {
                                                    "description": "analog_filter response file",
                                                    "properties" : {
                                                        "analog_filter" : {
                                                            "type": "string",
                                                            "description" : "(optional) response filename"
                                                        }
                                                    },
                                                    "additionalProperties": false
                                                }
                                            }
                                        }
                                    }
					            },
					            "sensor" : {
					                "description" : "Sensor equipment description and associated response(s)",
					                "patternProperties" : {
				                        "^[A-Za-z0-9_-]+$": {
                                            "required" : ["equipment","response"],
                                            "properties": {
                                                "equipment" : { "$ref": "#/definitions/equipmentType" },
                                                "response" : {
                                                    "required" : ["sensor"],
                                                    "description": "response files for sensor and any associated analog_filter",
                                                    "properties" : {
                                                        "sensor" : {
                                                            "type": "string",
                                                            "description" : "response filename"
                                                        },
                                                        "analog_filter" : {
                                                            "type": "string",
                                                            "description" : "(optional) response filename"
                                                        }
                                                    },
                                                    "additionalProperties": false
                                                }
                                            }
                                        }
                                    }
					            }
					        }
					    },
					    "specific" : {
					        "description" : "Specific descriptions of components (by serial number)",
					        "properties" : {
					            "datalogger" : {
					                "description" : "Specific datalogger description and associated responses",
					                "properties": {
					                    "equipment" : { "$ref": "#/definitions/equipmentType_noRequired" },
					                    "response" : {
					                        "description": "specific response files for datalogger components",
					                        "properties" : {
					                            "analog_filter" : {
					                                "type": "string",
					                                "description" : "name from response_files.analog_filter"
					                            },
					                            "digitizer" : {
					                                "type": "string",
					                                "description" : "name from response_files.digitizer"
					                            },
					                            "digital filter" : {
					                                "type": "string",
					                                "description" : "name from response_files.digital_filter"
					                            }
					                        }
					                    }
					                }
					            },
					            "preamplifier" : {
					                "description" : "Specific preamplifier description and (optionally) associated responses",
					                "properties": {
					                    "equipment" : { "$ref": "#/definitions/equipmentType_noRequired" },
					                    "response" : {
					                        "description": "specific analog_filter response file",
					                        "properties" : {
					                            "analog_filter" : {
					                                "type": "string",
					                                "description" : "name from response_files.analog_filter"
					                            }
					                        }
					                    }
					                }
					            },
					            "sensor" : {
					                "description" : "Specific sensor description and associated response(s)",
					                "properties": {
					                    "equipment" : { "$ref": "#/definitions/equipmentType" },
					                    "response" : {
					                        "description": "specific response files for sensor components",
					                        "properties" : {
					                            "sensor" : {
					                                "type": "string",
					                                "description" : "name from response_files.sensor"
					                            },
					                            "analog_filter" : {
					                                "type": "string",
					                                "description" : "name from response_files.analog_filter"
					                            }
					                        }
					                    }
					                }
					            }
							}
						}
					}
				}
			}
		}
	},
	"definitions": {
		"equipmentType": {
			"type": "object",
			"required": ["type", "description", "manufacturer", "vendor",
				"model", "serial_number", "calibration_date"
			],
			"properties": {
                "type": { "type": ["string","null"] },
                "description": { "type": ["string","null"] },
                "manufacturer": { "type": ["string","null"] },
                "vendor": { "type": ["string","null"] },
                "model": { "type": ["string","null"] },
                "serial_number": { "type": ["string","null"] },
                "calibration_date": {
                    "type": ["string","null"],
                    "description": "Date of calibration used in response file",
                    "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
                    "format": "date-time"
                }
			}
		},
		"equipmentType_noRequired": {
			"type": "object",
			"properties": {
                "type": { "type": ["string","null"] },
                "description": { "type": ["string","null"] },
                "manufacturer": { "type": ["string","null"] },
                "vendor": { "type": ["string","null"] },
                "model": { "type": "string" },
                "serial_number": { "type": ["string","null"] },
                "calibration_date": {
                    "type": ["string","null"],
                    "description": "Date of calibration used in response file",
                    "pattern": "^([0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z)|([0-9]{4})$"
                }
			}
		},
        "response_file_dict": {
            "type": "object",
			"patternProperties" : {
				"^[A-Za-z0-9_-]+$": {
					"type" : "string",
					"description" : "response file path"
				}
			}
        },
		"phone": {
            "type": "string",
            "description": "...",
			"pattern": "^[0-9]+-[0-9]+$"
		},
        "date": {
            "type": "string",
            "description": "Date in yyyy-mm-dd format",
			"pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "author" : {
			"type": "object",
			"required": ["first_name","last_name"],
            "properties": {
                "first_name": { "type": "string" },
                "last_name": { "type": "string" },
                "email": { "type": "string" },
                "institution": { "type": "string" },
                "telephone": { "type": ["string","null"] }
            }
        }
	}
}
