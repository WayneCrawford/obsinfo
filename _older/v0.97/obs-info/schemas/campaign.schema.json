{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Campaign",
	"description": "Data collection campaign, to be filled in by chief scientist",
	"type": "object",
	"required": [
		"campaign"
	],
	"properties": {
		"campaign": {
			"type": "object",
			"required": [
		        "format_version",
				"revision",
				"reference_name",
				"reference_scientist",
				"OBS_facilities",
				"data_distribution",
				"network",
				"validation_methods"
			],
			"properties": {
                "format_version": { "$ref": "#/definitions/format_version" },
				"revision": { "$ref": "#/definitions/revision" },
				"reference_name": { "$ref": "#/definitions/reference_name" },
				"reference_scientist": { "$ref": "#/definitions/author" },
				"network": { "$ref": "#/definitions/network" },
				"OBS_facilities": { "$ref": "#/definitions/OBS_facilities" },
				"data_distribution": { "$ref": "#/definitions/data_distribution" },
				"validation_methods": { "$ref": "#/definitions/validation_methods" },
				"expeditions": { "$ref": "#/definitions/expeditions" }
			}
		}
	},
	"definitions": {
        "format_version": { 
            "description": "Version of this file's schema",
            "type": "string",
            "minLength": 3,
            "pattern": "^0\\.97$"
        },
        "revision": {
            "type": "object",
            "title": "Information version ",
            "description": "Source and date of the provided information",
            "properties": {
                "date": { "$ref": "#/definitions/date" },
                "author": { "$ref": "#/definitions/author" }
            }
        },
        "reference_name": {
            "type": "string",
            "description": "campaign name (used in filename, as well)"
        },
        "network": {
            "type": "object",
            "description": "...",
            "required" : ["fdsn_code","start_date","end_date"],
            "properties": {
                "fdsn_code" : { "type": "string" },
                "start_date" : { "type": "string" },
                "end_date" : { "type": "string" },
                "description" : { "type": "string" }
            }
        },
        "OBS_facilities": {
            "type": "object",
            "description": "List of OBS facilities and their stations",
            "patternProperties": {
                "^.+$": {
                    "type":"object",
                    "title": "Facility name",
                    "properties": {
                        "email": {"type": "string"},
                        "stations": {
                            "type": "array", 
                            "description":"List of stations deployed by the facility"
                        }
                    }
                }
            }
        },
        "data_distribution": {
            "type": "object",
            "description": "Parameters related to data distribution",
            "properties": {
                "embargo_years": {
                    "type": "integer",
                    "description": "Requested years to embargo data (max 3 for RESIF)",
                    "minimum": 0,
                    "maximum": 10
                }
            }
        },
        "validation_methods": {
            "type":"object",
            "description":"information used to validate networ data/metadata",
            "required": ["waveform_windows"],
            "properties": {
                "waveform_windows": {
                    "type":"array",
                    "description": "list of waveform windows to plot",
                    "items": {  "$ref": "#/definitions/waveform_window" }
                }
            }
        },
        "waveform_window": {  
            "type":"object",
            "description": "waveform window to plot",
            "required": ["title","datetime","duration_s"],
            "properties":{
                "title": {"type":"string"},
                "date": {
                    "description":"start of plot window" ,
                    "type":"string",
                    "format":"date-time"
                },
                "duration_s": {
                    "description" : "number of seconds to plot" ,
                    "type" : "integer"
                },
                "source_position": {
                    "description":"position of source, used to plot waveforms by distance rather than alphabetically",
                    "type":"array",
                    "items": [
                        { "type":"number", "description":"longitude" },
                        { "type":"number", "description":"latitude" },
                        { "type":"number", "description":"depth (km)" }
                    ]
                }
            }
        },				            
        "expeditions": {
            "type":"array",
            "description": "list of shipgoing expeditions involved in data collection",
            "items": {
                "type":"object",
                "description": "expedition",
                "required": ["name","ship_name","start_date"],
                "properties":{
                    "name":      { "$ref": "#/definitions/string_or_null" },
                    "ship_name": { "$ref": "#/definitions/string_or_null" },
                    "comment":   { "$ref": "#/definitions/string_or_null" },
                    "report":    { 
                        "anyOf": [
                            {"type":"string", "format":"url"},
                            {"type":"null"}
                        ]
                    },
                    "start_date":  { "$ref": "#/definitions/date" },
                    "end_date":    { "$ref": "#/definitions/date" }
                }
            }
        },
        "string_or_null": { 
            "type" : [ "string" , "null" ]
        },
        "date": {
            "anyOf": [
                {
                    "type" : "string",
                    "description" : "yyyy-mm-dd date",
                    "pattern" : "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
                },
                {   "type" : "null" }
            ]
        },
        "author" : {
            "type": "object",
            "required": ["first_name","last_name"],
            "properties": {
                "first_name": { "type": "string" },
                "last_name": { "type": "string" },
                "email": { "type": "string" },
                "institution": { "type": "string" },
                "telephone": { "type": ["string","null"] }
            }
        }
	}
}
