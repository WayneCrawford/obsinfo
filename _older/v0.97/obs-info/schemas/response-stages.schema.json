{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Response",
	"description": "OBS instrument/stage response files. Stages are output in the order sensor -> ana_filter -> datalogger",
	"type": "object",
	"required": [ "stages" ],
	"properties": {
	    "stages" : {
	        "type" : "array",
	        "minItems": 1,
	        "description" : "list of response stages",
	        "items" : {
                "response_stage": { "$ref" : "#/definitions/response_stage" }
	        }
	     }
	},
	"definitions": {
        "response_stage": {
            "type" : "object",
            "description" : "Response type",
            "required" : [
                "input_units",
                "output_units",
                "gain",
                "response"
            ],
            "properties": {
                "input_units": { "$ref" : "#/definitions/stage_io_units" },
                "output_units": { "$ref" : "#/definitions/stage_io_units" },
                "gain" : { "$ref" : "#/definitions/gain" },
                "response" : { "$ref" : "#/definitions/response" },
                "description": {
                    "description": "(corresponds to response_name in DBIRD)",
                    "type": "string"
                },
                "decimation": { "$ref" : "#/definitions/decimation" },
                "DBIRD_response_type": {
                    "description": "examples: 'THEORETICAL', 'CALIBRATION'",
                    "type": "string"
                }
            }
        },	        
        "stage_io_units": { 
            "description": "units entering or exiting stage (e.g., 'V', 'PA', 'COUNTS')",
            "type": "string",
            "pattern": "[A-Z/*12-]+"
        },
        "gain" : { 
            "type" : "object",
            "description": "output units / input unit.  (Called sensitivity in DBIRD)",
            "required" : ["value", "frequency"],
            "properties" : {
                "value" : {"type" : "number"},
                "frequency" : {
                    "type" : "number",
                    "description": "Hz",
                    "default": 0
                }
            }
        },
        "response" : { 
            "oneOf" : [
                { "$ref" : "response.schema.json#definitions/response"},
                {
                    "type" : "object",
                    "required" : [
                        "type",
                        "include"
                    ],
                    "properties": {
                        "type" : {"type" : "string"},
                        "include" : {
                            "type" : "string", 
                            "description" : "name of file containing PoleZero information"
                        }
                    },
                    "additionalProperties": false
                }
            ]
        },
        "decimation": {
            "description": "Data decimation (only in digital stages)",
            "type": "object",
            "required" : [ 
                "input_sample_rate",
                "factor",
                "offset",
                "delay",
                "correction"
            ],
            "properties" : { 
                "input_sample_rate" :  {"type" : "number"},
                "factor" :             {"type" : "integer"}, 
                "offset" :             {"type" : "integer"},
                "delay" :              {"type" : "number"},
                "correction" :         {"type" : "number"}
            }
        }
    }
}