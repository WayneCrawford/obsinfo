{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Instrumentation-Components",
	"description": "OBS facility instrument components",
	"type": "object",
	"required": [
		"instrument_components"
	],
	"properties": {
		"instrument_components": { 
			"type": "object",
			"required": [
                "format_version",
				"revision",
				"facility",
				"response_files",
				"functional_components"
			],
			"properties": {
                "format_version": { "$ref": "#/definitions/format_version" },
				"revision": { "$ref": "#/definitions/revision" },
				"facility": { "$ref": "#/definitions/facility" },
				"response_files": { "$ref": "#/definitions/response_files" },
				"functional_components": { "$ref": "#/definitions/functional_components" },
                "notes": { "$ref": "#/definitions/comments" }
			},
            "additionalProperties": false
		}
	},
	"definitions": {
        "format_version": { 
            "description": "Version of this file's schema",
            "type": "string",
            "minLength": 3,
            "pattern": "^0\\.97$"
        },
        "revision": {
            "description": "Date provenance of instrumentation information",
            "type": "object",
            "required": ["date","authors"],
            "properties": {
                "date": { "$ref": "#/definitions/date" },
                "authors": {
                    "type": "array",
                    "minItems" : 1,
                    "items" : {"$ref": "#/definitions/author"}
                }
            },
            "additionalProperties": false
        },
        "facility": {
            "type": "object",
            "description": "OBS facility information",
            "required": [
                "reference_name", 
                "full_name", 
                "email", 
                "website"
            ],
            "properties": {
                "reference_name": {
                    "type": "string",
                    "description": "YAML filename should be '{reference_name}.instrumentation.yaml'"
                },
                "full_name": { "type": "string" },
                "email": { "type": "string", "format": "email" },
                "website": { "type": "string", "format": "uri" },
                "phone_number": { "type": "string", "format": "phone" }
            },
            "additionalProperties": false
        },
        "response_files": {
            "type" : "object",
            "required" : ["directory"],
            "properties" : {
                "directory": { "type": "string", "description": "directory in which the response files are found"},
                "format": { "type": "string", "enum": ["RESPONSE_YAML"]}
            },
            "additionalProperties" : false
        },
        "functional_components": {
            "type": "object",
            "description": "Functional component categories.",
            "required": ["datalogger","sensor"],
            "properties": {
                "datalogger" : {
                    "description" : "Datalogger specifications",
                    "required" : ["generic"],
                    "properties" : {
                        "generic" : { "$ref": "#/definitions/dataloggers_generic" },
                        "specific" : { "$ref": "#/definitions/dataloggers_specific" }
                    },
                    "additionalProperties": false
                },
                "preamplifier" : {
                    "description" : "Preamplifier specifications",
                    "required" : ["generic"],
                    "properties" : {
                        "generic" : { "$ref": "#/definitions/preamplifiers_generic" },
                        "specific" : { "$ref": "#/definitions/preamplifiers_specific" }
                    },
                    "additionalProperties": false
                },
                "sensor" : {
                    "description" : "Sensor specifications",
                    "required" : ["generic"],
                    "properties" : {
                        "generic" : { "$ref": "#/definitions/sensors_generic" },
                        "specific"  : { "$ref": "#/definitions/sensors_specific" }
                    },
                    "additionalProperties": false
                }
            },
            "additionalProperties": false
        },
        "sensors_generic" : { 
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "required" : ["equipment","response_files","seed_codes"],
                    "properties": {
                        "notes" : { "$ref": "#/definitions/comments" },
                        "equipment" : { "$ref": "#/definitions/equipmentType" },
                        "seed_codes" : { "$ref": "#/definitions/seed_codes" },
                        "response_files" : {
                            "required" : ["sensor"],
                            "description": "response files for sensor and any associated analog_filter",
                            "properties" : {
                                "sensor" : { "$ref": "#/definitions/response_filename" },
                                "analog_filter" : { "$ref": "#/definitions/response_filename" }
                            },
                            "additionalProperties": false
                        }
                    },
                    "additionalProperties": false
                }
            }
        },
        "seed_codes" : {
            "description": "Seed codes, azimuths and dips associated with a sensor",
            "type" : "object",
            "required" : [
                "band_base",
                "instrument",
                "orientation"
            ],
            "properties" : {
                "band_base" : {
                    "type" : "string",
                    "description" : "B for corner period >= 10s, S for <10s",
                    "enum" : ["B","S"]
                },
                "instrument" : {
                    "description" : "SEED instrument code",
                    "type" : "string",
                    "pattern" : "^[A-Z]$"
                },
                "orientation" : {  "$ref": "#/definitions/seed_orientation" }
            }
        },
        "seed_orientation" : {
            "description" : "permitted orientation codes and their azimuth and dip",
            "type" : "object",
            "patternProperties" : {
                "^[A-Z0-9]$" : {
                    "type" : "object",
                    "required" : ["azimuth","dip"],
                    "properties": {
                        "azimuth" : { "$ref": "#/definitions/azimuthType" },
                        "dip" : { "$ref": "#/definitions/dipType" }
                    }
                }
            }
        },
        "azimuthType" : { 
            "type" : "array",
            "numItems": 2 ,
            "items": [
                {
                    "description": "azimuth value (degrees)",
                    "type" : "number",
                    "minimum" : 0,
                    "maximum" : 360
                },
                {
                    "description": "azimuth error (degrees)",
                    "type" : "number",
                    "minimum" : 0,
                    "maximum" : 180
                }
            ]
        },
        "dipType" : { 
            "type" : "array",
            "numItems":2,
            "items": [
                {
                    "description": "dip value (degrees)",
                    "type" : "number",
                    "minimum" : -90,
                    "maximum" : 90
                },
                {
                    "description": "dip error (degrees)",
                    "type" : "number",
                    "minimum" : 0,
                    "maximum" : 90
                }
            ]
        },
        "response_filename" : {
            "type": "string",
            "description" : "response filename"
        },
        "sensors_specific"  : { 
            "description" : "Specific sensor description and (optionally) associated responses",
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "description" : "reference codes",
                    "patternProperties" : {
                        "^[A-Za-z0-9_-]+$": {
                            "properties": {
                                "equipment" : { "$ref": "#/definitions/equipmentType_noRequired" },
                                "response_files" : {
                                    "description": "specific response files for sensor components",
                                    "properties" : {
                                        "sensor" : {  "$ref": "#/definitions/response_filename" },
                                        "analog_filter" : {  "$ref": "#/definitions/response_filename" }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "dataloggers_generic" : {
            "description" : "Non-specific descriptions of dataloggers",
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "description" : "reference codes",
                    "required" : ["equipment","response_files"],
                    "properties": {
                        "equipment" : { "$ref": "#/definitions/equipmentType" },
                        "response_files" : {
                            "required" : ["digitizer"],
                            "description": "response files for analog_filter, digitizer and digital filter in datalogger",
                            "properties" : {
                                "analog_filter" : { "$ref": "#/definitions/response_filename" },
                                "digitizer" : { "$ref": "#/definitions/response_filename" },
                                "digital_filter" : { "$ref": "#/definitions/response_filename" }
                            },
                            "additionalProperties": false
                        }
                    }
                }
            }
        },
        "dataloggers_specific" : { 
            "description" : "Specific datalogger description and associated responses",
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "description" : "reference codes",
                    "patternProperties" : {
                        "^[A-Za-z0-9_-]+$": {
                            "description" : "serial numbers",
                            "properties": {
                                "equipment" : { "$ref": "#/definitions/equipmentType_noRequired" },
                                "response_files" : {
                                    "description": "specific response files for datalogger components",
                                    "properties" : {
                                        "analog_filter" : { "$ref": "#/definitions/response_filename" },
                                        "digitizer" : { "$ref": "#/definitions/response_filename" },
                                        "digital filter" : { "$ref": "#/definitions/response_filename" }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
        "preamplifiers_generic" : {
            "description" : "Standard properties",
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "description" : "reference codes",
                    "required" : ["equipment"],
                    "properties": {
                        "equipment" : { "$ref": "#/definitions/equipmentType" },
                        "response_files" : {
                            "description": "analog_filter response file",
                            "properties" : {
                                "analog_filter" : { "$ref": "#/definitions/response_filename" }
                            },
                            "additionalProperties": false
                        }
                    }
                }
            }
        },
        "preamplifiers_specific" : {
            "description" : "Specific preamplifier description and (optionally) associated responses",
            "patternProperties" : {
                "^[A-Za-z0-9_-]+$": {
                    "description" : "reference codes",
                    "patternProperties" : {
                        "^[A-Za-z0-9_-]+$": {
                            "description" : "serial numbers",
                            "properties": {
                                "equipment" : { "$ref": "#/definitions/equipmentType_noRequired" },
                                "response_files" : {
                                    "description": "specific analog_filter response file",
                                    "properties" : {
                                        "analog_filter" : { "$ref": "#/definitions/response_filename" }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        },
		"equipmentType": {
			"type": "object",
			"required": ["type", "description", "manufacturer", "vendor",
				"model", "serial_number", "calibration_date"
			],
			"properties": {
                "type": { "type": ["string","null"] },
                "description": { "type": ["string","null"] },
                "manufacturer": { "type": ["string","null"] },
                "vendor": { "type": ["string","null"] },
                "model": { "type": ["string","null"] },
                "serial_number": { "type": ["string","null"] },
                "calibration_date": {
                    "type": ["string","null"],
                    "description": "Date of calibration used in response file",
                    "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z$",
                    "format": "date-time"
                }
			}
		},
		"equipmentType_noRequired": {
			"type": "object",
			"properties": {
                "type": { "type": ["string","null"] },
                "description": { "type": ["string","null"] },
                "manufacturer": { "type": ["string","null"] },
                "vendor": { "type": ["string","null"] },
                "model": { "type": "string" },
                "serial_number": { "type": ["string","null"] },
                "calibration_date": {
                    "type": ["string","null"],
                    "description": "Date of calibration used in response file",
                    "pattern": "^([0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}Z)|([0-9]{4})$"
                }
			}
		},
        "comments": {
            "type": "array",
			"items" : {"type" : "string"}
        },
        "response_file_dict": {
            "type": "object",
			"patternProperties" : {
				"^[A-Za-z0-9_-]+$": {
					"type" : "string",
					"description" : "response file path"
				}
			}
        },
		"phone": {
            "type": "string",
            "description": "...",
			"pattern": "^[0-9]+-[0-9]+$"
		},
        "date": {
            "type": "string",
            "description": "Date in yyyy-mm-dd format",
			"pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "author" : {
			"type": "object",
			"required": ["first_name","last_name"],
            "properties": {
                "first_name": { "type": "string" },
                "last_name": { "type": "string" },
                "email": { "type": "string" },
                "institution": { "type": "string" },
                "telephone": { "type": ["string","null"] }
            }
        }
	}
}
