{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Network",
	"description": "Network of stations deployed by an OBS facility",
	"type": "object",
	"required": [
		"format_version",
		"network"
	],
	"properties": {
		"format_version": {
			"description": "Version of this file's schema",
			"type": "string",
			"minLength": 3,
			"pattern": "^0\\.92$"
		},
		"network": {
			"type": "object",
			"required": [
				"revision",
				"network_code",
				"instrumentation_file",
				"stations"
			],
			"properties": {
				"revision": {
					"type": "object",
					"description": "Date provenance of instrumentation information",
					"required": ["date"],
					"properties": {
					    "date": { "$ref": "#/definitions/date" },
					    "author": {"type":"string"},
					}
				},
				"network_code": {
					"type": "string",
					"description": "Network code (preferably FDSN network)"
				},
				"instrumentation_file": {
					"type": "string",
					"description": "file containing instrumentation refered to in 'stations.name.instrument' field"
				},
				"stations": {
					"type": "object",
					"description": "Seafloor seismological stations",
					"patternProperties": {
					    "^[A-Za-z0-9_-]+$": {
                            "type" : "object",
                            "description" : "Official station name",
                            "required": [
                                "sample_rate", 
                                "comment_list",
                                "site",
                                "start_date",
                                "end_date",
                                "instrument",
                                "locations",
                                "supplements"
                            ],
					        "properties": {
                                "sample_rate" : { "type" : "number" }, 
                                "comment_list" : { 
                                    "type" : "array",
                                    "description" : "station comments",
                                    "minItems": 0,
                                    "items" : { "type" : "string", "minLength" : 1 }
                                },
                                "site" : { "type" : "string", "minLength" : 1 },
                                "start_date" : { "$ref": "#/definitions/date-time-Z" },
                                "end_date" : { "$ref": "#/definitions/date-time-Z" },
                                "instrument" : { "$ref": "#/definitions/componentRef" },
                                "locations" : {
                                    "type" : "object",
                                    "description" : "sensor position by location code",
                                    "patternProperties": {
                                        "^[0-9]{2}$": {
                                            "type" : "object",
                                            "description" : "Location code (two digits)",
                                            "required": [
                                                "position",
                                                "uncertainties_m",
                                                "depth",
                                                "geology",
                                                "vault",
                                                "localisation_method"
                                            ],
                                            "properties": {
                                                "position" : { "$ref" : "#/definitions/GeoJSON" },
                                                "uncertainties_m" : { "$ref" : "#/definitions/GeoJSON_m" },
                                                "depth" : {
                                                    "kind": "number", 
                                                    "description" : "depth beneath the seafloor (m)"
                                                },
                                                "geology" : {
                                                    "kind": "string", 
                                                    "default" : "unknown"
                                                },
                                                "vault" : {
                                                    "kind": "string", 
                                                    "default" : "Sea floor"
                                                },
                                                "localization_method" : {
                                                    "kind": "string", 
                                                    "description" : "method used to locate instrument",
                                                    "examples" : [
                                                        "Short baseline transponder, seafloor release",
                                                        "Short baseline transponder, near-seafloor release",
                                                        "Position of ship at deployment",
                                                        "Acoustic (pinger) survey",
                                                        "Acoustic (airgun) survey",
                                                    ],
                                                }
                                            }
                                        }
                                    }
                                },
                                "supplements" : {
                                    "type": "object",
                                    "description": "information with no corresponding value in StationXML: convert to comments for now",
                                    "properties": {
                                        "initial_name" : {
                                            "type" : "string",
                                            "description" : "original station name (if different from official one)"
                                        },
                                        "obs-specific" : {
                                            "type" : "object",
                                            "description" : "OBS-specific information",
                                            "required" : ["clock_correction_linear"],
                                            "properties" : {
                                                "clock_correction_linear" : {
                                                    "type" : "object",
                                                    "description" : "Linear clock drift observed and any correction applied",
                                                    "required" : [
                                                        "time_base",
                                                        "reference",
                                                        "start_sync_reference",
                                                        "start_sync_instrument",
                                                        "end_sync_reference",
                                                        "end_sync_instrument"
                                                    ],
                                                    "properties" : {
                                                        "time_base" : {
                                                            "type" : "string",
                                                            "description" : "time base used in OBS"
                                                        },
                                                        "reference" : {
                                                            "type" : "string",
                                                            "description" : "time reference used for synchronization",
                                                            "examples" : ["GNSS"]
                                                        },
                                                        "start_sync_reference" : { "$ref": "#/definitions/date-time-Z" },
                                                        "start_sync_instrument" : {
                                                            "anyOf" : [
                                                                { "$ref": "#/definitions/date-time-Z" },
                                                                {
                                                                    "type" : "integer",
                                                                    "minimum" : 0,
                                                                    "maximum" : 0,
                                                                    "description": "Can use 0 if identical to start_sync_reference"
                                                                }
                                                            ]
                                                        },
                                                        "end_sync_reference" : { "$ref": "#/definitions/date-time-Z" },
                                                        "end_sync_instrument" : { "$ref": "#/definitions/date-time-Z" }
                                                    }
                                                },
                                                "clock_corretion_leapsecond" : {
                                                    "kind" : "object",
                                                    "description" : "Leap-second information",
                                                    "required" : ["time", "correction"],
                                                    "properties" : {
                                                        "time" : { "$ref": "#/definitions/date-time-Z" },
                                                        "description" : {
                                                            "type" : "string",
                                                            "description" : "Leapsecond properties",
                                                            "enum" : [
                                                                "Positive leapsecond (a 61-second minute)",
                                                                "Negative leapsecond (a 59-second minute)"
                                                            ]
                                                        },
                                                        "correction" : {
                                                            "type" : "object",
                                                            "required" : ["data", "end_sync_instrument"],
                                                            "properties" : {
                                                                "data" : { "type" : "string" },
                                                                "end_sync_instrument" : { "type" : "string" }
                                                                
                                                            }
                                                        },
                                                        "verification" : {"type" : "string"},
                                                        "leapsecond_flag_set" : {"type" : "boolean"}
                                                    },
                                                }
                                            }
                                        }
                                    }
                                },
                                "sensors": {
                                    "type" : "object",
                                    "description" : "Optional specification of sensors by component:location code",
                                    "patternProperties": {
                                        "^[A-Z]{3}:[0-9]{2}$": { "$ref": "#/definitions/componentRef" }
                                    }
                                },
                                "station_location" :
                                {
                                    "type" : "string",
                                    "description" : "location code to use for station position (default: first one specified)"
                                }
                            }
						}
					},
					"additionalProperties": false
				}
			}
		},
	},
	"definitions": {
        "componentRef": {
            "type": "object",
            "description": "Reference to a specific component",
            "required": ["model", "serial_number"],
            "properties": {
                "model": {
                    "anyOf": [
                        {
                            "type": "string",
                            "description": "component model (if None, use existing model (can only change serial number).  Otherwise, must correspond to a key in instrumentation:models:sensors)"
                        },
                        { "type" : "null" }
                    ]
                },
                "serial_number": {
                    "anyOf": [
                        {
                            "type": "string",
                            "description": "serial number.  If model specified, will search for specific instance of this model-serial number in instrumentation:individuals:sensors:model and use specific values there.  If not, will just fill in 'serial_number' field"
                        },
                        { "type" : "null" }
                    ]
                }
            }
        },
		"phone": {
            "type": "string",
            "description": "...",
			"pattern": "^[0-9]+-[0-9]+$"
		},
        "date": {
            "type": "string",
            "description": "Date in yyyy-mm-dd format",
			"pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "date-time-Z": {
            "anyOf" : [
                {
                    "type": "string",
                    "description": "Date-time in ISO format with Z for GMT+0",
			        "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]*)?Z$"
			    },
			    { "type" : "null" }
			]
        },
        "GeoJSON": {
            "type": "array",
            "description": "Object position [longitude (deg), latitude (deg), elevation (m)]",
            "minItems": 3,
            "maxItems": 3,
            "items" : {"kind" : "number" }
        },
        "GeoJSON_m": {
            "type": "array",
            "description": "Object uncertainties, all in meters [longitude (m), latitude (m), elevation (m)]",
            "minItems": 3,
            "maxItems": 3,
            "items" : {"kind" : "number" }
        }
	}
}
