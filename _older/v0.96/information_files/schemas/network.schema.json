{
	"$schema": "http://json-schema.org/draft-06/schema#",
	"title": "Network",
	"description": "Network of stations deployed by an OBS facility",
	"type": "object",
	"required": [ "network" ],
	"properties": {
		"network": {
			"type": "object",
			"required": [
		        "format_version",
				"revision",
				"network_info",
				"instrumentation_file",
				"stations"
			],
			"properties": {
                "format_version": {
                    "description": "Version of this file's schema",
                    "type": "string",
                    "minLength": 3,
                    "pattern": "^0\\.96$"
                },
				"revision": {
					"type": "object",
					"description": "Date provenance of instrumentation information",
					"required": ["date","authors"],
					"properties": {
					    "date": { "$ref": "#/definitions/date" },
                        "authors": {
                            "type": "list",
                            "minItems" : 1,
                            "items" : {
                                "type": "object",
                                "required": ["first_name", "last_name"],
                                "properties": {
                                  "first_name": {"type": "string"},
                                  "last_name": {"type": "string"},
                                  "email": {"type": "string", "format": "email"},
                                  "phones": {"type": "array", "items": {"$ref": "#/definitions/phone"}}
                                }
                            }
                        }
					}
				},
				"network_info": {
					"description": "Network information (if this is an FDSN network values should correspond to those on FDSN network page",
					"type": "object",
					"required" : ["code","start_date","end_date","description","comments"],
					"properties" : {
					    "code" : {
					        "type" : "string" , 
					        "description": "FDSN network code or 'XX'"
					    },
					    "start_date": { "$ref": "#/definitions/date" },
					    "end_date": { "$ref": "#/definitions/date" },
					    "description": {
					        "type" : "string" , 
					        "description": "Use FDSN 'network name'"
					    },
					    "comments" : {
					        "type" : "array",
					        "minItems" : 0,
					        "items" : {"type" : "string"}
					    }
					}
				},
				"instrumentation_file": {
					"type": "string",
					"description": "file containing instrumentation refered to in 'stations.name.instrument' field"
				},
				"stations": {
					"type": "object",
					"description": "Seafloor seismological stations",
					"patternProperties": {
					    "^[A-Za-z0-9_-]+$": {
                            "type" : "object",
                            "description" : "Official station name",
                            "required": [
                                "sample_rate", 
                                "comments",
                                "site",
                                "start_date",
                                "end_date",
                                "instrument",
                                "locations",
                                "supplements"
                            ],
					        "properties": {
					            "remarks" : {
					                "type": "array",
					                "description" : "notes by operator, will not be included in output data or metadata", 
					                "items": {"type":"string"}
					            },
                                "sample_rate" : { "type" : "number" }, 
                                "comments" : { 
                                    "type" : "array",
                                    "description" : "station comments",
                                    "minItems": 0,
                                    "items" : { "type" : "string", "minLength" : 1 }
                                },
                                "site" : { "type" : "string", "minLength" : 1 },
                                "start_date" : { "$ref": "#/definitions/date-time-Z" },
                                "end_date" : { "$ref": "#/definitions/date-time-Z" },
                                "instrument" : { "$ref": "#/definitions/elementRef" },
                                "locations" : {
                                    "type" : "object",
                                    "description" : "sensor position by location code",
                                    "patternProperties": {
                                        "^[0-9]{2}$": {
                                            "type" : "object",
                                            "description" : "Location code (two digits)",
                                            "required": [
                                                "position",
                                                "uncertainties_m",
                                                "depth",
                                                "geology",
                                                "vault",
                                                "localisation_method"
                                            ],
                                            "properties": {
                                                "position" : { "$ref" : "#/definitions/GeoJSON" },
                                                "uncertainties_m" : { "$ref" : "#/definitions/GeoJSON_m" },
                                                "depth" : {
                                                    "type": "number", 
                                                    "description" : "depth beneath the seafloor (m)"
                                                },
                                                "geology" : {
                                                    "type": "string", 
                                                    "default" : "unknown"
                                                },
                                                "vault" : {
                                                    "type": "string", 
                                                    "default" : "Sea floor"
                                                },
                                                "localization_method" : {
                                                    "type": "string", 
                                                    "description" : "method used to locate instrument. Examples : 'Short baseline transponder, seafloor release',  'Ship position at deployment', or 'Acoustic (pinger) survey'"
                                                }
                                            }
                                        }
                                    }
                                },
                                "supplements" : {
                                    "type": "object",
                                    "description": "information with no corresponding value in StationXML: convert to comments for now",
                                    "properties": {
                                        "initial_name" : {
                                            "type" : "string",
                                            "description" : "original station name (if different from official one)"
                                        },
                                        "obs-specific" : {
                                            "type" : "object",
                                            "description" : "OBS-specific information",
                                            "required" : ["clock_correction_linear"],
                                            "additionalProperties": false,
                                            "properties" : {
                                                "clock_correction_linear" : {
                                                    "type" : "object",
                                                    "description" : "Linear clock drift observed and any correction applied",
                                                    "required" : [
                                                        "time_base",
                                                        "reference",
                                                        "start_sync_reference",
                                                        "start_sync_instrument",
                                                        "end_sync_reference",
                                                        "end_sync_instrument"
                                                    ],
                                                    "properties" : {
                                                        "time_base" : {
                                                            "type" : "string",
                                                            "description" : "time base used in OBS"
                                                        },
                                                        "reference" : {
                                                            "type" : "string",
                                                            "description" : "time reference used for synchronization (for example, 'GNSS')"
                                                        },
                                                        "start_sync_reference" : { "$ref": "#/definitions/date-time-Z" },
                                                        "start_sync_instrument" : {
                                                            "anyOf" : [
                                                                { "$ref": "#/definitions/date-time-Z" },
                                                                {
                                                                    "type" : "integer",
                                                                    "minimum" : 0,
                                                                    "maximum" : 0,
                                                                    "description": "Can use 0 if identical to start_sync_reference"
                                                                }
                                                            ]
                                                        },
                                                        "end_sync_reference" : { "$ref": "#/definitions/date-time-Z" },
                                                        "end_sync_instrument" : { "$ref": "#/definitions/date-time-Z" }
                                                    }
                                                },
                                                "clock_correction_leapsecond" : {
                                                    "type" : "object",
                                                    "description" : "Leap-second information",
                                                    "required" : ["time", "description","end_sync_instrument_corrected"],
                                                    "properties" : {
                                                        "time" : { "$ref": "#/definitions/date-time-Z" },
                                                        "description" : {
                                                            "type" : "string",
                                                            "description" : "Leapsecond properties",
                                                            "enum" : [
                                                                "Positive leapsecond (a 61-second minute)",
                                                                "Negative leapsecond (a 59-second minute)"
                                                            ]
                                                        },
                                                        "end_sync_instrument_corrected" : {
                                                            "type" : "boolean",
                                                            "description" : "Was the end_sync_instrument corrected for the leap second? (subtract one second if positive leapsecond, add one if negative)"
                                                        },
                                                        "correction" : {
                                                            "type" : "object",
                                                            "required" : ["data", "end_sync_instrument"],
                                                            "properties" : {
                                                                "data" : { "type" : "string" },
                                                                "end_sync_instrument" : { "type" : "string" }
                                                                
                                                            }
                                                        },
                                                        "verification" : {"type" : "string"},
                                                        "leapsecond_flag_set" : {"type" : "boolean"}
                                                    }
                                                }
                                            }
                                        }
                                    }
                                },
                                "sensors": {
                                    "type" : "object",
                                    "description" : "Optional specification of sensors by component:location code",
                                    "patternProperties": {
                                        "^[A-Z]{3}:[0-9]{2}$": { "$ref": "#/definitions/elementRef" }
                                    }
                                },
                                "station_location" :
                                {
                                    "type" : "string",
                                    "description" : "location code to use for station position (default: first one specified)"
                                }
                            }
						}
					},
					"additionalProperties": false
				}
			}
		}
	},
	"definitions": {
        "elementRef": {
            "type": "object",
            "description": "Reference to a specific element (instrument or functional_component)",
            "required": ["reference_code", "serial_number"],
            "properties": {
                "reference_code": {
                    "anyOf": [
                        {
                            "type": "string",
                            "description": "reference code (if None, use existing reference_code (can only change serial number).  Otherwise, must correspond to a key in instrumentation or instrument_components)"
                        },
                        { "type" : "null" }
                    ]
                },
                "serial_number": {
                    "anyOf": [
                        {
                            "type": "string",
                            "description": "serial number.  If this reference_code/serial_number combination is specified, use its specific values.  If not, will just fill in 'serial_number' field"
                        },
                        { "type" : "null" }
                    ]
                }
            }
        },
		"phone": {
            "type": "string",
            "description": "...",
			"pattern": "^[0-9]+-[0-9]+$"
		},
        "date": {
            "type": "string",
            "description": "Date in yyyy-mm-dd format",
			"pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}$"
        },
        "date-time-Z": {
            "anyOf" : [
                {
                    "type": "string",
                    "description": "Date-time in ISO format with Z for GMT+0",
			        "pattern": "^[0-9]{4}-[0-9]{2}-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}(\\.[0-9]*)?Z$"
			    },
			    { "type" : "null" }
			]
        },
        "GeoJSON": {
            "type": "array",
            "description": "Object position [longitude (deg), latitude (deg), elevation (m)]",
            "minItems": 3,
            "maxItems": 3,
            "items" : {"type" : "number" }
        },
        "GeoJSON_m": {
            "type": "array",
            "description": "Object uncertainties, all in meters [longitude (m), latitude (m), elevation (m)]",
            "minItems": 3,
            "maxItems": 3,
            "items" : {"type" : "number" }
        }
	}
}
